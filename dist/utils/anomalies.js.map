{"version":3,"sources":["utils/anomalies.js"],"names":[],"mappings":"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","file":"utils/anomalies.js","sourcesContent":["'use strict';\n// Load system modules\n\n// Load modules\nlet _  = require( 'lodash' );\n\n// Load my modules\n\n// Constant declaration\nconst GREY_THRESHOLD = 6;\nconst NILS_TO_USE = [\n  1,\n  2,\n  4,\n  6,\n  7,\n  9,\n  10,\n  11,\n  20,\n  21,\n  22,\n  35,\n  44,\n  51,\n  52,\n  60,\n  69,\n  71,\n];\n\n// Module variables declaration\n\n// Module functions declaration\nfunction q( i, data ) {\n  let Fi = i/4; // QUARTILE so we use: 4\n  let n = data.length;\n  let int = Math.floor;\n\n  let prod = n*Fi;\n  let val;\n\n  // Check if the product is an integer\n  if( int( prod )===prod ) {\n    val = (data[ prod-1 ] + data[ prod ])/2;\n  } else {\n    val = data[ int( prod ) ];\n  }\n\n  return val;\n}\nfunction quartiles( percentages ) {\n  let quartile1 = q( 1, percentages );\n  let quartile2 = q( 2, percentages );\n  let quartile3 = q( 3, percentages );\n  let quartile4 = q( 4, percentages );\n\n  return {\n    quartile1: quartile1,\n    quartile2: quartile2,\n    quartile3: quartile3,\n    quartile4: quartile4,\n  };\n}\nfunction thresholds( percentages ) {\n  let quarts = quartiles( percentages );\n  let q1 = quarts.quartile1;\n  let q3 = quarts.quartile3;\n\n\n  let threshold1 = q1-1.5*(q3-q1);\n  let threshold2 = q1;\n  let threshold3 = q3;\n  let threshold4 = q3+1.5*(q3-q1);\n\n  return {\n    threshold1: threshold1,\n    threshold2: threshold2,\n    threshold3: threshold3,\n    threshold4: threshold4,\n  };\n}\n/*\nfunction filterNils( posts, nil ) {\n  // return posts.length>=GREY_THRESHOLD;\n  return _.contains( NILS_TO_USE, Number( nil ) );\n}\n*/\nfunction getLanguage( post ) {\n  let lang = post.lang.toLowerCase();\n  if( lang!=='it' && lang!=='en' ) {\n    return 'other';\n  } else {\n    return lang;\n  }\n}\nfunction getLanguagesPercentage( posts ) {\n  let length = posts.length;\n\n  return _( posts )\n  .countBy( getLanguage )\n  .mapValues( function( count ) {\n    return count/length;\n  } )\n  .value();\n}\n\nfunction getNilAnomalies( posts, lang ) {\n\n  let languagePercentagePerNil = _( posts )\n  // Group by nil\n  .groupBy( 'nil' )\n  // Use only the provided NILS\n  .pick( NILS_TO_USE )\n  // Get the percentage of each language\n  .mapValues( getLanguagesPercentage )\n  .value();\n\n  // Calculate the quartiles and the thresholds of the selected language\n  let selectedLanguagePercentages = _( languagePercentagePerNil )\n  // Get the percentages for the selected language\n  .map( lang )\n  // Sort ascending\n  .sortBy()\n  .value();\n\n  let ths = thresholds( selectedLanguagePercentages );\n  let t1 = ths.threshold1;\n  let t2 = ths.threshold2;\n  let t3 = ths.threshold3;\n  let t4 = ths.threshold4;\n\n\n  // Map the nil to the correct output\n  return _( languagePercentagePerNil )\n  .map( function( langs, nil ) {\n    let selectedLanguagePercentage = langs[ lang ];\n    let type;\n\n    if( selectedLanguagePercentage<=t1 ) {\n      type = 'Percentuale molto bassa';\n    } else if ( selectedLanguagePercentage>t1 && selectedLanguagePercentage<=t2 ) {\n      type = 'Percentuale bassa';\n    } else if ( selectedLanguagePercentage>t2 && selectedLanguagePercentage<=t3 ) {\n      type = 'Percentuale non anomala';\n    } else if ( selectedLanguagePercentage>t3 && selectedLanguagePercentage<=t4 ) {\n      type = 'Percentuale alta';\n    } else if ( selectedLanguagePercentage>t4 ) {\n      type = 'Percentuale molto alta';\n    }\n\n    return {\n      value: selectedLanguagePercentage,\n      type: type,\n      nil_id: Number( nil ), // jshint ignore:line\n    };\n  } )\n  .filter( 'type' )\n  .value();\n}\n\n\n// Module class declaration\n\n// Module initialization (at first load)\n\n// Entry point\n\n// Exports\nmodule.exports.getNilAnomalies = getNilAnomalies;\nmodule.exports.NILS_TO_USE = NILS_TO_USE;\n\n\n//  50 6F 77 65 72 65 64  62 79  56 6F 6C 6F 78"],"sourceRoot":"/source/"}