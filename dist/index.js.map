{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;kBAIe,IAAI;;;;mBACH,KAAK;;;;yBACD,YAAY;;;;uBACd,UAAU;;;;sBACT,QAAQ;;;;;;qBAG4B,UAAU;;gCACxC,uBAAuB;;;;kCACpB,wBAAwB;;;;6BAC7B,mBAAmB;;;;iCACf,uBAAuB;;;;iCACvB,uBAAuB;;;;6BAC3B,mBAAmB;;;;AAjB1C,YAAY,CAAC;;;;;AAwBb,IAAI,GAAG,GAAG,kBAAK,CAAC;AAChB,IAAI,GAAG,GAAG,oBAAO,YAAY,CAAE;AAC7B,MAAI,EAAE,QAAQ;AACd,OAAK,EAAE,OAAO,EACf,CAAE,CAAC;;;;;;;AAUJ,GAAG,CAAC,IAAI,GAAG,mBAAmB,CAAC;AAC/B,GAAG,CAAC,KAAK,GAAG,IAAI,CAAC;;;AAIjB,yCAAI;MAQE,MAAM,EAaJ,IAAI;;;;;AAnBV,eAlCO,IAAI,EAkCA,CAAC;;;AAGZ,WAAG,CAAC,GAAG,CAAE,sBAAM,CAAE,CAAC;;AAGd,cAAM,GAAG,2BAAY,GAAG,CAAE;;AAE9B,cAAM,CAAC,GAAG,CAAE,mBAAmB,kCAAmB,CAAC;AACnD,cAAM,CAAC,GAAG,CAAE,cAAc,6BAAc,CAAC;AACzC,cAAM,CAAC,GAAG,CAAE,kBAAkB,iCAAkB,CAAC;AACjD,cAAM,CAAC,GAAG,CAAE,kBAAkB,iCAAkB,CAAC;AACjD,cAAM,CAAC,GAAG,CAAE,cAAc,6BAAc,CAAC;;;AAGzC,WAAG,CAAC,GAAG,CAAE,MAAM,CAAC,MAAM,EAAE,CAAE,CAAC;AAC3B,WAAG,CAAC,GAAG,CAAE,MAAM,CAAC,cAAc,EAAE,CAAE,CAAC;;AAG7B,YAAI,iCAAJ,IAAI;;AACV,WAAG,CAAC,KAAK,CAAE,wBAAwB,EAAE,IAAI,CAAE,CAAC;AAC5C,WAAG,CAAC,MAAM,CAAE,IAAI,CAAE,CAAC;;;;;;;CACpB,EAAE,SACG,CAAE,UAAA,GAAG,EAAI;AACb,KAAG,CAAC,KAAK,CAAE,GAAG,EAAE,aAAa,CAAE,CAAC;AAChC,SA3D0B,KAAK,EA2DnB,CAAC;AACb,SAAO,CAAC,IAAI,CAAE,CAAC,CAAE,CAAC;CACnB,CAAE,CAAC","file":"index.js","sourcesContent":["'use strict';\r\n// Load system modules\r\n\r\n// Load modules\r\nimport co from 'co';\r\nimport koa from 'koa';\r\nimport Router  from 'koa-router';\r\nimport cors  from 'koa-cors';\r\nimport bunyan from 'bunyan';\r\n\r\n// Load my modules\r\nimport { open as openMongo, close as closeMongo } from './model/';\r\nimport serverConfig from '../config/server.json';\r\nimport districtAnomaly from './api/district-anomaly';\r\nimport topAnomaly from './api/top-anomaly';\r\nimport districtTweets from './api/district-tweets';\r\nimport timelineTweets from './api/timeline-tweets';\r\nimport textTweets from './api/text-tweets';\r\n\r\n\r\n// Constant declaration\r\n\r\n\r\n// Module variables declaration\r\nlet app = koa();\r\nlet log = bunyan.createLogger( {\r\n  name: 'server',\r\n  level: 'trace',\r\n} );\r\n\r\n\r\n// Module functions declaration\r\n\r\n// Module class declaration\r\n\r\n\r\n\r\n// Module initialization (at first load)\r\napp.name = 'UrbanScope server';\r\napp.proxy = true;\r\n\r\n\r\n// Entry point\r\nco( function*() {\r\n  // Setup mongo\r\n  openMongo();\r\n\r\n  // Middlewares\r\n  app.use( cors() );\r\n\r\n  // Add endpoints\r\n  let router = new Router( app );\r\n\r\n  router.get( '/anomaly/district', districtAnomaly );\r\n  router.get( '/anomaly/top', topAnomaly );\r\n  router.get( '/tweets/district', districtTweets );\r\n  router.get( '/tweets/timeline', timelineTweets );\r\n  router.get( '/tweets/text', textTweets );\r\n\r\n  // Add the router to the Koa Application\r\n  app.use( router.routes() );\r\n  app.use( router.allowedMethods() );\r\n\r\n  // Start server\r\n  let { port } = serverConfig;\r\n  log.debug( 'Start server @ port %d', port );\r\n  app.listen( port );\r\n} )\r\n.catch( err => {\r\n  log.fatal( err, 'NUOOOOOOOOO' );\r\n  closeMongo();\r\n  process.exit( 1 );\r\n} );\r\n\r\n//  50 6F 77 65 72 65 64  62 79  56 6F 6C 6F 78"],"sourceRoot":"/source/"}